{% extends "base/base.html" %}
{% load static %}

{% block extrahead %}
<link rel="stylesheet" type="text/css" href="{% static 'css/book_club/club_admit.css' %}" />
{% endblock extrahead %}

{% block title %}
Club Admit
{% endblock title %}

{% block content %}
<head>
	<style>
		.active {
			color: red;
		}
		.container_single_requester {
			display: flex;
		}
		.request-done {
			display: none;
		}
	</style>
</head>
<body>
	<div class="container">
		북클럽 참여 희망 명단
		북클럽 현재 인원 <span class="member-cnt_span">{{book_club.member_cnt}}/{{book_club.member_total}}</span>

		<div class="container_all_requesters">
			{% for member in members %}
				<div class="container_single_requester">
					<div class="requester_profile">
						<img class="profile_img" src="{{ member.user.avatar }}">
						{{ member.user.nickname }}
					</div>
					<button class="request_btn" onclick="changeMember(event, {{ member.id }}, {{ book_club.id }}, 'MEMBER')">수락</button>
					<button class="request_btn" onclick="changeMember(event, {{ member.id }}, {{ book_club.id }}, 'REJECT')">거절</button>
				</div>
			{% endfor %}

		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script>

        axios.defaults.xsrfCookieName = 'csrftoken'
        axios.defaults.xsrfHeaderName = "X-CSRFTOKEN"
        const requestButton = document.querySelector(".request_btn");
        const memberSpan = document.querySelector(".member-cnt_span");

        const changeMember = async (event, memberId, clubId, type) => {
            const url = "admit";
            const container = event.target.parentElement;
            container.classList.add("request-done");

            const response = await axios.patch(url, { memberId, clubId, type })
            const club = response.data.club;
            memberSpan.innerText = club.memberCnt + "/" + club.maxCnt;

		}

	</script>
	{% endblock content %}


</body>

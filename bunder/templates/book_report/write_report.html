{% extends "base/base.html" %}
{% load static %}

<head>
    <title>Write Report</title>
</head>

{% block content %}
<form action="{% url 'book_report:create' %}" method="post">
    <div class="container">
        <div class="report_container">
            <div class="inputBox">
                <input type="text" required="required" name='report_name' id='report_name'>
                <span>독후감 제목</span>
            </div>
            <div class="inputBox book_search">
                <div class="search_bar">
                    <input type="text" required="required" name='book_name' id='book_name'>
                    <span>책 제목</span>
                </div>
{#                <div class="inputBox">#}
{#                    {{error}} <input type="submit" value="검색">#}
{#                </div>#}
            </div>
            <div class="inputBox">
                {{error}} <button type="button" value="검색">버튼</button>
            </div>
        </div>
        <div class="book_result">
            <div class="book_img">
                <img src="" class="book_cover">
            </div>
            <div class="book_info">
                <p class="book_name">책 제목 : book_name</p>
                <p class="author">글쓴이 : author</p>
                <p class="category">
                    카테고리 : <select name="book_category" id="book_category">
                        <option value="문학">문학</option>
                        <option value="경제/경영">경제/경영</option>
                        <option value="예술">예술</option>
                        <option value="자기계발">자기계발</option>
                        <option value="정치/사회">정치/사회</option>
                        <option value="과학">과학</option>
                        <option value="기술IT">기술/IT</option>
                    </select>
                </p>
            </div>
        </div>
        <div class="report_content">
            <!--https://codepen.io/magnificode/pen/rQpaBO-->
            <div class="holes"></div>
            <textarea name="content" id="content" placeholder="독후감 본문"></textarea>
        </div>
        <form action="{% url 'book_report:create' %}" method="post"></form>
        <div class="inputBox">
            {{error}} <input type="submit" value="독후감 발행">
        </div>
</form>
</div>

    <script>
    const key = JSON.parse("{{ bookSecret|escapejs }}");
    const bookInfo = [];

    const fetchFunc = () => {
        return fetch (`https://www.googleapis.com/books/v1/volumes?q=서촌의기억&key=${key}`)
        .then(res => res.json())
        .then(res => {
            for (let book of res.items) {
                const singleBook = book?.volumeInfo;
                const tmp = {};
                if (singleBook?.authors) {
                    tmp.title = singleBook.title;
                    tmp.author = singleBook.authors[0];
                    tmp.imageLink = singleBook?.imageLinks;
                    bookInfo.push(tmp)
                }
            }
        })
    }

    const init = async () => {
        await fetchFunc();
        console.log(bookInfo);
    }

    init();
    </script>
{% endblock content %}
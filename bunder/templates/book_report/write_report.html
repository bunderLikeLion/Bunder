{% extends "base/base.html" %}
{% load static %}

<head>
    <title>Write Report</title>
</head>

{% block extrahead %}
<link rel="stylesheet" type="text/css" href="{% static 'css/book_report/write_report.css' %}" />
{% endblock extrahead %}

{% block content %}
<form action="{% url 'book_report:create' %}" method="post">
    <div class="container">
        <div class="report_container">
            <div class="inputBox">
                <input type="text" required="required" name='report_name' id='report_name'>
                <span>독후감 제목</span>
            </div>
            <div class="inputBox book_search">
                <div class="search_bar">
                    <input type="text" required="required" name='book_name' id='book_name'>
                    <span>책 제목</span>
                </div>
{#                <div class="inputBox">#}
{#                    {{error}} <input type="submit" value="검색">#}
{#                </div>#}
            </div>
<<<<<<< HEAD
=======
            <div class="inputBox">
                <input type="text" id="book_search_input">
                <span>책 검색</span>
                {{error}} <button type="button" id="book_search_btn" value="검색">버튼</button>
            </div>
>>>>>>> e0601d8d1e5fd8e11ab81dfff976b10181c2d721
        </div>
        <div class="book_result">
            <div class="book_img">
                <img src="" class="book_cover">
            </div>
            <div class="book_info">
                <p class="book_name">책 제목 : book_name</p>
                <p class="author">글쓴이 : author</p>
                <p class="category">
                    카테고리 : <select name="book_category" id="book_category">
                        <option value="문학">문학</option>
                        <option value="경제/경영">경제/경영</option>
                        <option value="예술">예술</option>
                        <option value="자기계발">자기계발</option>
                        <option value="정치/사회">정치/사회</option>
                        <option value="과학">과학</option>
                        <option value="기술IT">기술/IT</option>
                    </select>
                </p>
            </div>
        </div>
        <div class="report_content">
            <!--https://codepen.io/magnificode/pen/rQpaBO-->
            <div class="holes"></div>
            <textarea name="content" id="content" placeholder="독후감 본문"></textarea>
        </div>
        <form action="{% url 'book_report:create' %}" method="post"></form>
        <div class="inputBox">
            {{error}} <input type="submit" value="독후감 발행">
        </div>
</form>
</div>
    <button id="btn-modal">모달 버튼</button>
        <div id="modal" class="modal-overlay">
        <div class="modal-window">
            <div class="title">
                <h2>책 검색 결과</h2>
            </div>
            <div class="close-area">X</div>
            <div class="content">
                <p>가나다라마바사 아자차카타파하</p>
                <p>가나다라마바사 아자차카타파하</p>
                <p>가나다라마바사 아자차카타파하</p>
                <p>가나다라마바사 아자차카타파하</p>

            </div>
        </div>
    </div>

    <script>
    {#modal-related code#}
    const modal = document.getElementById("modal")
    const btnModal = document.getElementById("btn-modal")
    btnModal.addEventListener("click", e => {
        modal.style.display = "flex"
    })

    const closeBtn = modal.querySelector(".close-area")
    closeBtn.addEventListener("click", e => {
    modal.style.display = "none"
    })

    modal.addEventListener("click", e => {
    const evTarget = e.target
    if(evTarget.classList.contains("modal-overlay")) {
        modal.style.display = "none"
    }
    })

    {#category converter#}
        const categoryConverter = (category) => {
        const typedCategory = category.toUpperCase();
            const new_category = {"문학" :
    ['ANTIQUES & COLLECTIBLES',
    'JUVENILE FICTION',
    'JUVENILE NONFICTION',
    'COMICS & GRAPHIC NOVELS',
    'LITERARY COLLECTIONS',
    'LITERARY CRITICISM',
    'DRAMA',
    'FICTION',
    'POETRY',
    'YOUNG ADULT FICTION',
    'YOUNG ADULT NONFICTION'
    ],
    "경제/경영" : [
        'BUSINESS & ECONOMICS'
    ],
    "자기계발" : [
        'COOKING',
        'CRAFTS & HOBBIES',
        'FOREIGN LANGUAGE STUDY',
        'STUDY AIDS',
        'HEALTH & FITNESS',
        'GARDENING',
        'GAMES & ACTIVITIES',
        'BODY, MIND & SPIRIT',
        'SELF-HELP',
        'TRAVEL'
    ],
    "인문" : [
        'BIOGRAPHY & AUTOBIOGRAPHY',
        'EDUCATION',
        'LANGUAGE ARTS & DISCIPLINES',
        'FAMILY & RELATIONSHIPS',
        'HISTORY',
        'HOUSE & HOME',
        'HUMOR',
        'PETS',
        'REFERENCE',
        'PHILOSOPHY',
        'SPORTS & RECREATION'
    ],
    "정치/사회" : [
        'TRUE CRIME',
        'LAW',
        'BIBLES',
        'RELIGION',
        'SOCIAL SCIENCE'
    ],
    "예술" : [
        'ART',
        'DESIGN',
        'PHOTOGRAPHY',
        'PERFORMING ARTS',
        'MUSIC',
    ],
    "과학" : [
        'MATHEMATICS',
        'MEDICAL',
        'NATURE'
    ],
    "기술/IT" : [
        'COMPUTERS',
        'TRANSPORTATION',
        'ARCHITECTURE',
        'TECHNOLOGY & ENGINEERING'
    ]
    }
        for (let cat in new_category) {
            if (new_category[cat].includes(typedCategory)) {
            return cat;
            break;
        }
    }}




    {#getting data from api#}

    const searchInputVal = document.querySelector('#book_search_input');
    const searchBtn = document.querySelector('#book_search_btn');
    const key = JSON.parse("{{ bookSecret|escapejs }}");
    const bookInfo = [];

    const fetchFunc = (bookName) => {
        return fetch (`https://www.googleapis.com/books/v1/volumes?q=${bookName}&key=${key}`)
        .then(res => res.json())
        .then(res => {
            for (let book of res.items) {
                if (bookInfo.length >= 6) break;
                const singleBook = book?.volumeInfo;
                const tmp = {};
                if (singleBook?.authors && singleBook?.categories) {
                    tmp.title = singleBook.title;
                    tmp.author = singleBook.authors[0];
                    tmp.imageLink = singleBook?.imageLinks;
                    tmp.category = categoryConverter(singleBook?.categories[0]);
                    bookInfo.push(tmp)
                }
            }
        })
    }


    searchBtn.addEventListener('click', async () => {
        await fetchFunc(searchInputVal.value);
        console.log(bookInfo);
    })


    </script>
{% endblock content %}